\documentclass[../main.tex]{subfiles}

\begin{document}

\chapter{АНАЛІЗ І ПРОЕКТУВАННЯ ANDROID-ЩОДЕННИКА ДЛЯ МАНДРІВНИКІВ}

\section{Формування та аналіз вимог до Android-щоденника мандрівника}

\subsection{Формування вимог до Android-щоденника для мандрівників}

Розглянувши існуючі на цей час програмні продукти, такі як~щоденники для мандрівників, проаналізувавши їх, та виявивши як~позитивні так і негативні сторони, можна сформувати задачі розробки. В~узагальненому вигляді такою задачею є створення додатку, що буде забезпечувати можливість ведення щоденнику, запису треку переміщень та~планування поїздок.

При проектуванні програмного продукту необхідно забезпечити наступні можливості:
\begin{enumerate}
	\item Авторизація за допомогою облікового запису Google.
	\item Можливість створення подорожі.
	\item Можливість створення записів щоденника.
	\item Можливість створення записів планувальника.
	\item Можливість встановлення нагадувань за часом.
	\item Можливість встановлення нагадувань за місцем.
	\item Можливість запису треку переміщень.
\end{enumerate}

На основі первинних вимог були розроблені наступні детальні вимоги:
\begin{enumerate}
	\item Надати можливість редагувати подорож.
	\item Надати можливість видаляти подорож.
	\item Надати можливість редагувати запис щоденника.
	\item Надати можливість видаляти запис щоденника.
	\item Надати можливість редагувати запис планувальника.
	\item Надати можливість видаляти запис планувальника.
	\item Надати можливість додавати зображення до запису щоденника.
	\item Надати можливість переглядати карту з треком і мітками.
	\item Надати можливість обирати подорож для запису щоденника та~планувальника.
	\item Надати можливість встановлювати активну подорож.
	\item Надати можливість синхронізувати дані між пристроями.
	\item Надати можливість ділитися записами щоденника через інші додатки.
	\item Надати можливість ділитися окремими зображеннями з запису щоденника через інші додатки.
	\item Надати можливість додавати списки з прапорцями в запис планувальника.
	\item Надати можливість системі автоматично завантажувати дані про погодні умови та місцезнаходження при створенні запису щоденника.
\end{enumerate}

\subsection{Аналіз вимог до щоденника мандрівника}
Аналіз вимог є частиною процесу розробки програмного забезпечення, що включає в себе збір вимог щодо програмного забезпечення, їх систематизацію, виявлення взаємозв'язків, а також документування.

Авторизація за допомогою облікового запису Google.
Для того, щоб користувач мав доступ тільки до своїх даних, та мав можливість синхронізації з іншими пристроями, він повинен мати свій обліковий запис в базі даних. Оскільки в якості бази даних використовується Firebase, маємо такі варіанти авторизації користувачів: 
\begin{itemize}[label={--}]
	\item за допомогою соціальних мереж (Google, Facebook, Twitter);
	\item за допомогою акаунта GitHub;
	\item за допомогою адреси електронної пошти;
	\item анонімна авторизація.
\end{itemize}

Майже всі користувачі Android-пристроїв мають акаунт Google, тому було вирішено використовувати саме цей метод авторизації. В майбутньому можуть бути додані будь-які інші методи авторизації.

%Можливість створення подорожі.
Оскільки розроблюваний додаток є щоденником для мандрівників, користувач повинен мати змогу створювати подорожі. Створені подорожі слугують категоріями, в яких можуть знаходитися записи щоденника та планувальника. Також трек переміщень пов'язаний з певною мандрівкою.

%Можливість створення записів щоденника.
Користувач, який встановив Android-щоденник, очікує від нього можливість ведення цього щоденника, тому однією з головних вимог такого додатку є змога створення записів у щоденнику. Для створення запису, користувачу не~обов'язково потрібно мати створені подорожі. Записи без вказаної подорожі будуть розміщуватися в загальному щоденнику.

%Можливість створення записів планувальника.
Важливим пунктом для мандрівників є планування поїздок, тому користувач повинен мати змогу створювати записи планувальника, в яких він зможе описати все, що йому потрібно зробити при плануванні подорожі.

%Можливість встановлення нагадувань.
При підготовці до подорожі важливо не забути завершити заплановані справи та зібрати необхідні речі чи документи, тому користувач повинен мати змогу встановлювати нагадування для записів планувальника. Нагадування можуть бути встановлені на конкретний час, чи по приближенню до~вказаного місця.

%Можливість запису треку переміщень.
Користувач повинен мати змогу записувати трек свого переміщення. Це допоможе не забути якими маршрутами він рухався, та  які місця відвідав. Запис треку можливий при наявності активної подорожі. Для забезпечення цієї вимоги необхідно передбачити механізм запису місцезнаходження користувача в період його подорожі до бази даних.

%\subsection{Об'єктний аналіз вимог Android-щоденника для мандрівників}
\subsection{Формування вимог до Android-щоденника за допомогою діаграми прецедентів}
На основі визначених вимог було побудовано діаграму прецедентів (див. рис. \ref{diagram:usecase}), яка дозволить отримати візуальне уявлення про вимоги користувачів.

Користувач повинен мати можливість авторизуватися в додатку за~допомогою акаунта Google. Після вибору акаунта користувачем, Firebase перевіряє дані та відбувається авторизація користувача. Також, користувач повинен мати змогу створювати подорожі, записи щоденника та планувальника. Для створених записів планувальника повинна бути можливість встановлювати нагадування. Для подорожей користувач повинен мати можливість записувати трек переміщень. Всі дані зберігаються до бази даних та синхронізуються з допомогою Firebase.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{diagram_usecase}
	\caption{Діаграма прецедентів механізму роботи з додатком}
	\label{diagram:usecase}
\end{figure}

%% TODO а воно точно нормальний вигляд має на папері? Такі ігри з кольорами часто потім мають препаршивий вигляд на папері, та й взагалі не~рекомендується перевантажувати дипломну хитрими форматуваннями

%% TODO хоч я і паршиво для керівника дипломної роботи знаю ці діаграми, але факт, що акторами повинні бути лише зовнішні щодо розроблюваної системи чинники я все-таки знаю точно. До такого ТОЧНО ПРИЧЕПЛЯТЬСЯ. Якщо точно-точно нема користувачів з різними правами доступу щоб робити їх різними акторами, то, мабуть, треба зробити іншими акторами звернення до сторонніх систем... Хоча це краще ще десь уточнити.


\subsection{Формування та аналіз вимог до щоденника  під Android за допомогою діаграми діяльності}
Моделюючи поведінку системи, яка проектується або проводиться її~аналіз, постає необхідність деталізувати особливості алгоритмічної і логічної реалізації виконуваних системою операцій. Для такого моделювання в мові UML використовуються діаграми діяльності.

У контексті мови UML діяльність (activity) є деякою сукупністю окремих обчислень, що виконуються автоматом. При цьому окремі елементарні обчислення можуть наводити до деякого результату або дії (action). На діаграмі діяльності відображається логіка або послідовність переходу від однієї діяльності до іншої, при цьому увага фіксується на~результаті діяльності. Сам же результат може привести до зміни стану системи або повернення деякого значення.

%TODO: add more diagrams and descriptions or change section title

Діаграма діяльності створення нового запису щоденника, що~відображає поведінку проектованого додатка, подана на рис. \ref{diagram:activity}.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\textwidth]{diagram_activity}
	\caption{Діаграма діяльності механізму створення запису щоденника}
	\label{diagram:activity}
\end{figure}

В процес створення запису щоденника залучений як користувач, так і~система. Після того, як користувач вирішує створити новий запис, система отримує координати місцезнаходження користувача, та, при наявності інтернет з'єднання, завантажує інформацію про місцезнаходження та дані про погодні умови в цьому місці. Після введення користувачем потрібних йому даних, та завершення створення запису, дані зберігаються.

\subsection{Аналіз вимог до Android-щоденника мандрівника за допомогою діаграми послідовності}
На базі отриманих даних, і заради детальнішого моделювання була розроблена діаграма послідовностей для процесу сотворення запису планувальника та встановлення нагадування.

На діаграмі послідовності об’єкт зображується у вигляді прямокутника на вершині пунктирної вертикальної лінії. Ця вертикальна лінія називається лінією життя об’єкту. Вона є фрагментом життєвого циклу об’єкту в процесі взаємодії. Кожне повідомлення представляється у вигляді стрілки між лініями життя двох об’єктів. Повідомлення з’являються в тому порядку, як вони показані на діаграмі (зверху вниз). Кожне повідомлення може бути позначене ім’ям.

%TODO: add more diagrams or change title

\begin{figure}[H]
	\centering
	\includegraphics[width=0.85\textwidth]{diagram_sequence}
	\caption{Діаграма послідовності створення запису планувальника та~встановлення нагадування} %TODO: rename
	\label{diagram:sequence}
\end{figure}

Як видно з діаграми послідовності (див. рис. \ref{diagram:sequence}), після створення нагадування, дані записуються до бази даних та відбувається встановлення будильників у системі. 

\subsection{Аналіз вимог до щоденника для мандрівників під Android за допомогою діаграми комунікації}
Діаграми комунікації відображають взаємодію ролей або об'єктів у~процесі функціонування системи, описують обмін даними (повідомленнями) між різними учасниками взаємодії. Такі діаграми моделюють сценарії поведінки системи~\cite{diploma_guidelines}. 

Діаграма комунікації для процесу перегляду подорожі та створення запису щоденника зображена на рис. \ref{diagram:communication}.

\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{diagram_communication}
	\caption{Діаграма комунікації механізм перегляду подорожей та записів щоденника}
	\label{diagram:communication}
\end{figure}

При виборі користувачем подорожі чи запису щоденника, дані завантажуються з бази даних, та відображаються користувачеві. Також, знаходячись на екрані перегляду подорожі, користувач може вирішити створити запис щоденника для цієї подорожі.

\section{Об’єктно-орієнтоване проектування Android-щоденника мандрівника} %TODO: remove this

\subsection{Архітектурне проектування Android-щоденника} %TODO: change this to \section
Формування архітектури – перший і основний крок у розв’язанні завдання проектування, що закладає фундамент уявлення програмної системи, здатної виконувати весь спектр детальних вимог~\cite{diploma_guidelines2}.

Створення архітектури – це проектування на найвищому рівні (логічна архітектура). Логічна архітектура описує систему в термінах її~принципової організації у вигляді пакетів, програмних класів і підсистем. Вона називається логічною, оскільки не визначає способи розгортання цих елементів у різних операційних системах або на фізичних комп’ютерах в~мережі (це відноситься до архітектури розгортання)~\cite{diploma_guidelines}.

Система Android надає різнобічну платформу додатків, на основі якої можна створювати інноваційні програми та ігри для мобільних пристроїв в~середовищі мови Java. Важливо знати наступні основні концепції, що~стосуються платформи додатків Android.

Додатки мають кілька точок входу.
Додатки для Android будуються з окремих компонентів, які можна викликати незалежно один від одного. Наприклад, окрема активність надає один екран для користувацького інтерфейсу, а служба незалежно виконує роботу у~фоновому режимі.

За допомогою об'єкта Intent з одного компонента можна запустити інший. Також можна запустити компонент з іншої програми, наприклад, активність з картографічного додатка, щоб показати адресу. Ця модель формує кілька точок входу для однієї програми, і при цьому користувач може вибрати будь-який додаток за замовчуванням для виконання тієї чи~іншої дії, яка може викликати інші додатки.

Додатки адаптуються до різних пристроїв.
Android надає адаптивну платформу додатків, яка дозволяє забезпечувати унікальні ресурси для різних конфігурацій пристроїв. Наприклад, можна створити різні файли \mbox{XML-макета} для екранів різних розмірів, а система буде визначати, який макет використовувати, з урахуванням розміру екрану даного пристрою.

Якщо якимось функціям програми потрібне певне обладнання, наприклад камера, можна запитувати його наявність в пристрої під час виконання. При необхідності також можна оголошувати функції, які потрібні додатку, для того, щоб такі магазини додатків, як Google Play, не~дозволяли встановлювати додатки на пристроях, в яких цих функцій немає~\cite{android_4}.

Одним з важливих етапів архітектурного проектування є побудова діаграми пакетів. Діаграма пакетів є діаграмою, яка містить пакети класів і~залежності між ними. Вона описує архітектурну основу системи та~допомагає в управлінні масштабами й складністю системи. 

%TODO: describe all packages

\begin{figure}[h]
	\centering
	\includegraphics[width=1\textwidth]{diagram_packages}
	\caption{Діаграма пакетів для Android-щоденника}
	\label{diagram:packages}
\end{figure}

%«»

Пакет «adapters» призначений для адаптерів. Адаптер -- це об'єкт, що~діє як міст між представленням (view) і даними для цього представлення. Він забезпечує доступ до елементів даних. Також, адаптер відповідальний за~подання представлення для кожного елемента в наборі даних~\cite{adapter}. 

В пакеті «models» будуть знаходитися класи моделей, що необхідні для взаємодії з базою даних чи іншими сервісами. Пакет «screens» призначений для класів активностей, що являють собою окремі екрани додатку, тому в~нього були додані додаткові пакети, щоб розділити екрани по областях, за~які вони відповідають. Пакет «services» буде містити служби, а пакети «ui», «bus» та «interfaces» -- компоненти, що відповідають за інтерфейс користувача, шину подій та Java інтерфейси відповідно. Для детальної діаграми пакетів додатка~див.~рис.~\ref{diagram:packages}.

%\subsection{Побудова діаграми компонентів}
Ще одним будівельним блоком для створення архітектури \mbox{об'єктно-орієнтованої} системи вважається компонент. Діаграма компонентів показує розбиття програмної системи на структурні компоненти та залежності між компонентами. В якості фізичних компонентів можуть бути файли, бібліотеки, модулі, виконувані файли, пакети і т.п. У багатьох середовищах розробки модуль або компонент відповідає файлу. Стрілки, що з'єднують модулі, показують відносини взаємозалежності аналогічні тим, які мають місце при компіляції вихідних текстів програм. Основними графічними елементами діаграми компонентів є компоненти, інтерфейси й залежності між ними. 

Клас «Application» є базовим класом для підтримки глобального стану програми. Для того, щоб надати йому власну реалізацію, потрібно створити підклас і вказати його повне ім'я в файлі маніфесту. В нашому випадку таким підкласом є «App». Він створюється в першу чергу, до того, як процес для додатка/пакета створиться.

Активності, яким потрібна однакова базова логіка, наслідуються від класу «BaseActivity». Всі сервіси додатку наслідуються від класу «Service» або «IntentService» та мають бути вказані в файлі маніфесту. Детальну структуру компонентів додатку зображено на рис. \ref{diagram:hierarchy}.
%  (стор.~\pageref{diagram:hierarchy})

% \begin{figure}[H] % TODO думаю, тут все-таки краще спочатку пустити далі текст, далі розмістити рисунок. Дозволяє позбутися надто великих вертикальних дірок, вимогами розд.6.4 цілком допускається, і насправді активно використовується у практиці верстки взагалі.
\begin{figure}[p]
	\centering
	\includegraphics[width=0.8\textwidth]{diagram_hierarchy}
	\caption{Діаграма компонентів Android-щоденника}
	\label{diagram:hierarchy}
\end{figure}

%TODO: describe all components or crop diagram

\subsection{Детальне проектування Android-щоденника мандрівника} %TODO: replace with \section
Функціонально, додаток складається з наведених нижче модулів (активностей та фрагментів). Активність є схемою представлення Android-додатків. Кожен екран користувацькокого інтерфейсу представлений класом «Activity» і по суті є окремою формою додатка. Android-додаток може складатися з декількох активностей і може перемикатися між ними під час виконання програми. 

Фрагмент (клас «Fragment») представляє поведінку або частину користувацького інтерфейсу в активностях. Можливе об'єднання кількох фрагментів в одній активності для побудови багатопанельного інтерфейсу та повторного використання фрагмента в декількох активностях. Фрагмент можна розглядати як модульну частину активності. Така частина має свій життєвий цикл і самостійно обробляє події введення. Крім того, її можна додати або видалити безпосередньо під час виконання активності. Це щось на зразок вкладеної активності, яку можна багаторазово використовувати в~різних активностях.

При запуску додатку, користувач потрапляє на активність авторизації. Вона містить логотип, назву додатку та кнопку авторизації, пісня натиснення якої  користувачеві пропонується вибрати один з уже існуючих чи додати новий Google акаунт. Пісня успішної авторизації користувач потрапляє на~головний екран додатку.

Головний екран містить бокове меню (Navigation Drawer), яке містить три категорії: подорожі, щоденник та планувальник. При виборі категорії фрагмент, що знаходиться в цій активності, замінюється на той, що~відповідає цій категорії. За замовчуванням обрана категорія «подорожі», тому головна активність містить фрагмент зі списком подорожей. При виборі категорії «щоденник» чи «планувальник», цей фрагмент замінюється на фрагмент зі списком записів щоденника чи планувальника відповідно. При виборі елементу зі списку, відбувається перехід до відповідних активностей.

Активність подорожі відкривається при виборі подорожі зі списку. Вона містить сторінки на яких відображаються фрагмент зі списком записів щоденника, фрагмент зі списком записів планувальника та фрагмент з~картою. З меню, що міститься в цій активності, можливий перехід до~активності редагування подорожі.

Активність запису щоденника містить текст запису, список прикріплених фото та інформацію про погодні умови та місце створення запису. Для перегляду всіх прикріплених фото відкривається нова активність, що містить список цих фото. Також можливе редагування чи видалення запису. Активність запису планувальника слугує для його перегляду та редагування.

Фрагмент, що містить карту відображається на одній зі сторінок в~активності подорожі. На цій карті зображується записаний трек переміщень та мітки, які можуть означати початок чи кінець треку та запис щоденника чи планувальника. Фрагменти зі списками подорожей, записів щоденника чи планувальника завантажують відповідну інформацію з бази даних та на підставі отриманих даних формують динамічний список об'єктів за допомогою адаптеру «FirebaseRecyclerAdapter».

Діаграма активностей та фрагментів розроблюваного додатка представлена на рис. \ref{diagram:activities}.

%TODO: change this diagram somehow, or move to development section
\begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{diagram_activities}
	\caption{Діаграма активностей та фрагментів}
	\label{diagram:activities}
\end{figure}

%TODO: ---
Для того, щоб додаток міг взаємодіяти з базою даних, зберігати та~зчитувати дані, потрібно спроектувати моделі для необхідних об'єктів. Основними об'єктами є подорож, запис щоденника та планувальника.

Подорож повинна мати назву, опис, час створення, початку та~завершення, а також індикатор, який вказує активна вона чи ні. Додатково містяться поля для обкладинки подорожі. У записі щоденника буде міститися назва, текст, список фото, а також час створення та~інформація про погодні умови і місце створення запису. Запис планувальника також буде містити назву та текст, відмітку про виконання та відомості про нагадування, такі як час та дата чи місце нагадування.

Для збереження інформації про погоду було створено модель, яка містить поля для температури, тиску та інших погодних параметрів. Для збереження інформації про місцезнаходження для запису щоденника, було створено модель, що містить назву країни, міста, вулиці та інші відомості про це місце. Для запису треку переміщень необхідно зберігати координати користувача з деякою періодичністю. Для цього було створено модель, що~містить мапу, ключем в якій є час, а значенням -- координати користувача.

Детальна діаграма моделей для додатка зображена на рис.~\ref{diagram:models} (стор.~\pageref{diagram:models}).

%TODO: describe all models or crop diagram

\subsection{Розгортання програмної системи для мандрівників на апаратних засобах} %TODO: \section
Оскільки при розробці викорисловувалися сервіси Firebase, система може бути розгорнута під будь-яку платформу, що підтримує Firebase (Web, iOS, Unity та ін.). За темою роботи проводилася розробка Android клієнту. Діаграму розгортання системи представлено на рис. \ref{diagram:deployment}.

Для функціонування додатку необхідна операційна система Android версії 4.2 (API 16) і вище.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.8\textwidth]{diagram_deployment}
	\caption{Діаграма розгортання системи}
	\label{diagram:deployment}
\end{figure}

\section{Висновки до другого розділу}

У цьому розділі було сформовано вимоги до Android-щоденника на~основі результатів аналізу існуючих програмних продуктів. На основі сформованих вимог було побудовано діаграму прецедентів та визначено  детальні вимоги. Детальні вимоги відображають функції, якими необхідно наділити систему для забезпечення повного функціонування.

Також, було проведено аналіз вимог за допомогою діаграм діяльності, послідовності та комунікації, які допомагають отримати додаткове уявлення про сформовані вимоги.

Результатом роботи над даним розділом є формування та створення архітектури, що є основними кроками у розв'занні завдання проектування. Вони закладають фундамент програмної системи, описують систему в~термінах її принципової організації у вигляді пакетів, програмних класів і~підсистем.

\newpage
Також, було проаналізовано основні концепції платформи Android додатків. Було побудовано діаграму пакетів, на якій відображено пакети та зв'язки між ними, та діаграму компонентів, яка показує розбиття програмної системи на структурні компоненти та залежності між ними.

Проведено детальне проектування системи, створено діаграму взаємодії активностей додатку та діаграму моделей. Також описано розгортання системи на апаратних засобах, розроблено схему розгортання та описано необхідні засоби для функціонування додатку.

%%TODO: dont know how to skip pages
\begin{figure}[pt] %% TODO див. позаминулий рисунок
	%% \begin{figure}[H]
	\centering
	\includegraphics[width=1\textwidth]{diagram_models}
	\caption{Діаграма моделей Android-щоденника} %TODO: rename to classes diagram
	\label{diagram:models}
\end{figure}

\end{document}